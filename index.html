<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>J-Cours – Réservation de créneaux</title>

  <style>
:root {
  --marine: #0b1c2d;
  --gold: #c9a24d;
  --white: #ffffff;
  --light-bg: #f4f6f9;
  --radius: 14px;
  --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
}

* { box-sizing: border-box; }

body {
  font-family: "Inter", "Segoe UI", Arial, sans-serif;
  background: linear-gradient(180deg, #eef2f6, var(--light-bg));
  padding: 30px 16px;
  color: var(--marine);
}

h1 {
  font-size: 2.2rem;
  font-weight: 800;
  letter-spacing: -0.5px;
  margin-bottom: 5px;
}

h2 {
  font-size: 1.6rem;
  font-weight: 700;
  margin-bottom: 15px;
}

p { color: #4a5b6b; }

.container {
  max-width: 900px;
  margin: auto;
}

input {
  padding: 14px 16px;
  width: 100%;
  margin: 20px 0 25px;
  border-radius: var(--radius);
  border: 1.5px solid #ccd5df;
}

input:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 3px rgba(201, 162, 77, 0.2);
}

.slot {
  background: var(--white);
  padding: 18px 20px;
  margin: 14px 0;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  display: flex;
  justify-content: space-between;
  border-left: 6px solid var(--gold);
}

.full { opacity: 0.6; }

button {
  padding: 10px 18px;
  border: none;
  border-radius: 999px;
  cursor: pointer;
  background: var(--marine);
  color: var(--white);
  font-weight: 600;
}

button:hover {
  background: var(--gold);
  color: var(--marine);
}

button:disabled {
  background: #cfd6dd;
  color: #7a8694;
}

#admin {
  margin-top: 50px;
  background: var(--white);
  padding: 25px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border-top: 5px solid var(--marine);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

th {
  background: var(--marine);
  color: var(--white);
  padding: 14px;
}

td {
  border-bottom: 1px solid #e5e9ef;
  padding: 12px;
  text-align: center;
}

td button {
  padding: 4px 10px;
  font-size: 0.8rem;
  background: transparent;
  border: 1px solid var(--marine);
}
  </style>
</head>

<body>
<div class="container">
  <h1>J-Cours – Réservation</h1>
  <p style="text-align:center">7 places maximum par créneau</p>

  <input id="name" placeholder="Prénom de l'élève" />
  <div id="slots"></div>

  <div style="text-align:center;margin-top:20px;">
    <button onclick="openAdmin()">Accès Prof</button>
  </div>

  <div id="admin"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCDJRbeW9KWrLzuI3v2kBUDulKcb3REKy8",
  authDomain: "reservation-cour.firebaseapp.com",
  projectId: "reservation-cour",
  storageBucket: "reservation-cour.appspot.com",
  messagingSenderId: "156100724990",
  appId: "1:156100724990:web:c77c49e487d1d519a5fdaf"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const slots = [
  "Lundi 17-19","Lundi 19-21",
  "Mardi 17-19","Mardi 19-21",
  "Jeudi 17-19","Jeudi 19-21",
  "Mercredi 14-16","Mercredi 16-17",
  "Dimanche 9-11","Dimanche 11-13"
];

const MAX = 7;
const ADMIN_PASSWORD = "2805";

let data = {};
let isAdmin = false;

async function loadData(){
  for(const slot of slots){
    const snap = await getDoc(doc(db,"reservations",slot));
    data[slot] = snap.exists() ? snap.data().students : [];
  }
  render();
}

async function saveSlot(slot){
  await setDoc(doc(db,"reservations",slot),{
    students: data[slot]
  });
}

window.openAdmin = function(){
  const pass = prompt("Mot de passe prof");
  if(pass !== ADMIN_PASSWORD) return alert("Mot de passe incorrect");

  isAdmin = true;
  document.getElementById("admin").innerHTML = `
    <h2>Emploi du temps (Prof)</h2>
    <table>
      <thead>
        <tr><th>Créneau</th><th>Élèves inscrits</th></tr>
      </thead>
      <tbody id="adminTable"></tbody>
    </table>
  `;
  render();
};

function render(){
  const slotsDiv = document.getElementById("slots");
  slotsDiv.innerHTML = "";

  const adminTable = document.getElementById("adminTable");
  if(adminTable) adminTable.innerHTML = "";

  slots.forEach(slot=>{
    const count = data[slot].length;

    const div = document.createElement("div");
    div.className = "slot"+(count>=MAX?" full":"");
    div.innerHTML = `<strong>${slot}</strong><br>${count}/${MAX} places`;

    const btn = document.createElement("button");
    btn.textContent = "Réserver";
    btn.disabled = count>=MAX;
    btn.onclick = ()=>reserve(slot);

    div.appendChild(btn);
    slotsDiv.appendChild(div);

    if(isAdmin && adminTable){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${slot}</td>
        <td>
          ${data[slot].map((name,index)=>
            `${name} <button onclick="removeStudent('${slot}',${index})">❌</button>`
          ).join("<br>")}
        </td>
      `;
      adminTable.appendChild(tr);
    }
  });
}

/* ✅ MODIFICATION ICI : SMS */
async function reserve(slot){
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("Entre ton prénom");
  if(data[slot].includes(name)) return alert("Déjà inscrit");

  data[slot].push(name);
  await saveSlot(slot);
  render();

  const message = encodeURIComponent(
    `Bonjour,\nJe viens de réserver un créneau J-Cours.\n\nNom : ${name}\nCréneau : ${slot}`
  );

  window.location.href = `sms:0619336183?body=${message}`;
}

window.removeStudent = async function(slot,index){
  if(!confirm("Supprimer cet élève ?")) return;
  data[slot].splice(index,1);
  await saveSlot(slot);
  render();
}

loadData();
</script>

</body>
</html>
